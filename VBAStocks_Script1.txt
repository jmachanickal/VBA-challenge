Sub VBAStocks()

Dim i, roww As Integer
Dim opening, closing As Double
Dim total, vol As Long
Dim ticker As String
Dim ws As Worksheet

'Go through each worksheet
For Each ws In ActiveWorkbook.Worksheets
    
    'Set the labels'
    ws.Range("I1").Value = "Ticker"
    ws.Range("J1").Value = "Yearly Change"
    ws.Range("K1").Value = "Percent Change"
    ws.Range("L1").Value = "Total Stock Volume"

    'Set the default Ticker and Opening stock market price variables from the first row of raw data
    ticker = ws.Cells(2, 1).Value
    opening = ws.Cells(2, 3).Value
    total = ws.Cells(2, 7).Value
    
    'Set these varibles to default values
    vol = 0
    roww = 2
    
    'Set NumRows for the loop to stop at an empty cell
    NumRows = ws.Range("A3", ws.Range("A2").End(xlDown)).Rows.Count
    'Select cell A3
    Range("A3").Select
    
    'Use for loop to go through each row starting at the second row up til an empty cell
    For i = 3 To NumRows
        
        'If the new ticker equals the previous ticker, add to the total
        If ws.Cells(i, 1).Value = ticker Then
            closing = ws.Cells(i, 6).Value
            vol = ws.Cells(i, 7).Value
            total = total + vol
        
        'If the new ticker is not equal to the previous ticker, input the variables and start variables allover
        ElseIf ws.Cells(i, 1).Value <> ticker Then
            'Fill in columns I-L
            ws.Cells(roww, 9).Value = ticker
            ws.Cells(roww, 10).Value = closing - opening
            If opening = 0 Then
                ws.Cells(roww, 11).Value = 0
            Else
                ws.Cells(roww, 11).Value = Round(((closing - opening) / opening) * 100, 2)
            End If
            ws.Cells(roww, 12).Value = total
            
            'Fill in the Yearly Change interior color based on +/- value
            If ws.Cells(roww, 10).Value > 0 Then
                ws.Cells(roww, 10).Interior.ColorIndex = 4
            ElseIf ws.Cells(roww, 10).Value < 0 Then
                ws.Cells(roww, 10).Interior.ColorIndex = 3
            End If
            
            ticker = ws.Cells(i, 1).Value
            opening = ws.Cells(i, 3).Value
            total = ws.Cells(i, 7).Value
            roww = roww + 1
        End If
    Next i
Next

End Sub